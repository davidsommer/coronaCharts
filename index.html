<!doctype html>
<html>

<head>
	<title>Corona Line Chart by country</title>
	<style src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.9.3/Chart.min.css"></style>
    <style>
        canvas {
            -moz-user-select: none;
            -webkit-user-select: none;
            -ms-user-select: none;
        }
    </style>
</head>

<body>
<div style="width:100%;">
    <canvas id="canvas"></canvas>
</div>
<script
src="https://code.jquery.com/jquery-3.4.1.min.js"
integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo="
crossorigin="anonymous">
</script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.9.3/Chart.bundle.min.js"></script>
<script>
    var timeFormat = 'MM/DD/YY';

	function generateDatasets(data, countrys) {
		var datasets = [];

		for (const country of countrys) {
			var dataPoints = [];
			for (const entrie of getConfirmedHistoryDataByCountryCode(data, country)) {
				dataPoints.push({
					x: new Date(entrie[0]),
					y: entrie[1]
				});
			}
			dataPoints.sort(sortFunction);

			var dataset = {
					label: country,
					data: dataPoints,
					lineTension: 0,
					fill: false,
					borderColor: getRandomColor()
				};
			datasets.push(dataset);
		}
		return datasets
	}

	function getConfirmedHistoryDataByCountryCode(data, countryCode) {
		return Object.entries(data.locations.filter(function(v) {
			return v.country_code==countryCode
		})[0].history);
	}

	function sortFunction(a,b){  
		var dateA = a.x.getTime();
		var dateB = b.x.getTime();
		return dateA > dateB ? 1 : -1;  
	}; 

	function getRandomColor() {
		var letters = '0123456789ABCDEF';
		var color = '#';
		for (var i = 0; i < 6; i++) {
			color += letters[Math.floor(Math.random() * 16)];
		}
		return color;
	}

	function drawLineChart() {
		let countrys = ["CH", "DE", "FR", "IT", "ES", "GB", "US", "CN"]

		var jsonData = $.ajax({
			url: 'https://coronavirus-tracker-api.herokuapp.com/confirmed',
			dataType: 'json',
		}).done(function (results) {

			var config = {
				type:    'line',
				data:  {
					datasets: generateDatasets(results, countrys)
				},
				options: {
					responsive: true,
					hoverMode: 'index',
					stacked: false,
					title:      {
						display: true,
						text:    "Corona Line Chart by country"
					},
					tooltips: {
						mode: 'index'
					},
					scales:     {
						xAxes: [{
							type:       "time",
							time:       {
								parse: timeFormat,
								tooltipFormat: 'll'
							},
							scaleLabel: {
								display:     true,
								labelString: 'Date'
							}
						}],
						yAxes: [{
							scaleLabel: {
								display:     true,
								labelString: 'value'
							}
						}]
					}
				}
			};

			// Get the context of the canvas element we want to select
			var ctx = document.getElementById("canvas").getContext("2d");
			// Instantiate a new chart
			var myLineChart = new Chart(ctx, config);
		});

	}

	drawLineChart();
</script>
</body>
</html>